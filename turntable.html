<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>è±ªè¯æ…¢é€Ÿè½‰ç›¤ - å½ˆçª—å‰”é™¤ç‰ˆ</title>
    <style>
        :root { --primary: #4a90e2; --accent: #ff4757; }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .main-layout { display: flex; gap: 30px; max-width: 1100px; width: 100%; }
        .config-panel { flex: 1; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .wheel-panel { flex: 1.5; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; position: relative; }
        
        textarea { width: 100%; height: 120px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; padding: 12px; box-sizing: border-box; font-size: 14px; }
        .option-group { background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; border: 1px solid #eee; cursor: pointer; }
        
        button#spinBtn { background: var(--accent); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-size: 20px; width: 100%; font-weight: bold; transition: 0.3s; box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3); }
        button#spinBtn:hover { transform: scale(1.02); background: #ff6b81; }
        button#spinBtn:disabled { background: #ccc; transform: none; box-shadow: none; }

        /* è½‰ç›¤å¤–æ®¼ */
        .wheel-container { position: relative; margin: 20px auto; width: 450px; height: 450px; }
        
        /* æ—‹è½‰æ ¸å¿ƒï¼šè¨­å®š 7 ç§’èˆ‡æ¥µæ…¢æ¸›é€Ÿæ›²ç·š */
        #wheelCanvas { 
            width: 100%; 
            height: 100%; 
            transition: transform 7s cubic-bezier(0.1, 0, 0, 1); 
            border-radius: 50%;
        }
        
        /* æŒ‡æ¨™ */
        .pointer { 
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%); 
            width: 0; height: 0; border-left: 15px solid transparent; 
            border-right: 15px solid transparent; border-top: 30px solid #2d3436; 
            z-index: 10; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.2)); 
        }

        /* ä¸­çå½ˆçª— */
        #resultModal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 100; justify-content: center; align-items: center; 
        }
        .modal-content { 
            background: white; padding: 50px; border-radius: 30px; text-align: center; 
            max-width: 450px; width: 85%; animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.3); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .modal-content h1 { color: var(--accent); font-size: 48px; margin: 10px 0; }
        .modal-content p { font-size: 24px; color: #555; margin-bottom: 35px; }
        .close-btn { background: #2f3542; color: white; border: none; padding: 12px 40px; border-radius: 50px; font-size: 20px; cursor: pointer; transition: 0.2s; }
        .close-btn:hover { background: #000; }
        
        .history { margin-top: 20px; height: 120px; overflow-y: auto; border-top: 1px solid #eee; padding-top: 10px; font-size: 14px; text-align: left; }
    </style>
</head>
<body>

    <h1 style="color: #2d3436;">è½‰ç›¤æŠ½ç</h1>

    <div class="main-layout">
        <div class="config-panel">
            <h3>ğŸ‘¥ 1. äººå“¡åå–®</h3>
            <textarea id="namesInput" oninput="updateWheel()" placeholder="è¼¸å…¥äººåï¼Œæ¯è¡Œä¸€äºº">é·—å€ª1è™Ÿ&#10;é·—å€ª2è™Ÿ&#10;é·—å€ª3è™Ÿ&#10;é·—å€ª4è™Ÿ&#10;é·—å€ª5è™Ÿ&#10;é·—å€ª6è™Ÿ</textarea>
            
            <h3>ğŸ 2. çé …æ± </h3>
            <textarea id="prizesInput" placeholder="è¼¸å…¥çé …">é ­çï¼šå¤©è³&#10;è²³çï¼š2880&#10;åƒçï¼š1880</textarea>

            <label class="option-group">
                <input type="checkbox" id="autoRemove" checked>
                <span><strong>ç¢ºèªçµæœå¾Œï¼Œè‡ªå‹•ç§»é™¤è©²äººå“¡</strong></span>
            </label>
            
            <button id="spinBtn" onclick="spin()">ğŸ”¥ é–‹å§‹æŠ½ç (æ…¢é€Ÿé‹è½‰)</button>
            
            <div class="history">
                <strong>ğŸ“œ ç²çç´€éŒ„ï¼š</strong>
                <div id="historyList"></div>
            </div>
        </div>

        <div class="wheel-panel">
            <div class="wheel-container">
                <div class="pointer"></div>
                <canvas id="wheelCanvas" width="800" height="800"></canvas>
            </div>
            <h2 id="status" style="color: var(--primary);">ç¥æ‚¨ä¸­å¤§çï¼</h2>
        </div>
    </div>

    <div id="resultModal">
        <div class="modal-content">
            <div style="font-size: 80px; margin-bottom: 10px;">ğŸ†</div>
            <h1 id="modalWinner">ä¸­çè€…</h1>
            <p id="modalPrize"></p>
            <button class="close-btn" onclick="closeModal()">ç¢ºèªä¸¦æ›´æ–°åå–®</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const namesInput = document.getElementById('namesInput');
        const prizesInput = document.getElementById('prizesInput');
        const autoRemoveCheckbox = document.getElementById('autoRemove');
        const statusText = document.getElementById('status');
        const spinBtn = document.getElementById('spinBtn');
        const modal = document.getElementById('resultModal');

        let currentRotation = 0;
        let isSpinning = false;
        let activeNames = [];
        let lastWinnerIndex = -1;

        // æ›´æ–°è½‰ç›¤
        function updateWheel() {
            activeNames = namesInput.value.trim().split('\n').filter(n => n.trim() !== "");
            drawWheel();
        }

        // ç¹ªè£½è½‰ç›¤åœ–å½¢
        function drawWheel() {
            const num = activeNames.length;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = centerX - 20;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (num === 0) {
                ctx.textAlign = "center";
                ctx.font = "30px Arial";
                ctx.fillText("è«‹è¼¸å…¥åå–®...", centerX, centerY);
                return;
            }

            const angleStep = (Math.PI * 2) / num;
            activeNames.forEach((name, i) => {
                const startAngle = i * angleStep;
                const endAngle = (i + 1) * angleStep;
                
                // ç•«æ‰‡å€
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.fillStyle = `hsl(${(i * 360) / num}, 75%, 80%)`;
                ctx.fill();
                ctx.strokeStyle = "rgba(255,255,255,0.5)";
                ctx.lineWidth = 2;
                ctx.stroke();

                // ç•«æ–‡å­— (æ—‹è½‰ 90 åº¦è®“æ–‡å­—æ”¾å°„ç‹€æ’åˆ—)
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + angleStep / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#2d3436";
                ctx.font = "bold 26px Arial";
                ctx.fillText(name, radius - 40, 10);
                ctx.restore();
            });
        }

        // åŸ·è¡Œæ—‹è½‰
        function spin() {
            if (isSpinning || activeNames.length === 0) return;
            const prizes = prizesInput.value.trim().split('\n').filter(p => p !== "");
            if (prizes.length === 0) { alert("è«‹è¼¸å…¥çé …æ± å…§å®¹ï¼"); return; }

            isSpinning = true;
            spinBtn.disabled = true;
            statusText.innerText = "æ…¢é€Ÿè½‰å‹•ä¸­ï¼Œè«‹å±æ¯ä»¥å¾…...";

            // æ±ºå®šè´å®¶
            lastWinnerIndex = Math.floor(Math.random() * activeNames.length);
            const luckyPrize = prizes[Math.floor(Math.random() * prizes.length)];
            
            // è¨ˆç®—è§’åº¦ï¼š10åœˆ + å‘½ä¸­è§’åº¦
            const sectorDegree = 360 / activeNames.length;
            const stopDegree = 360 - (lastWinnerIndex * sectorDegree) - (sectorDegree / 2);
            
            // è¨­å®šæ—‹è½‰åº¦æ•¸ (7ç§’)
            currentRotation += (360 * 10) + (stopDegree - (currentRotation % 360));
            canvas.style.transform = `rotate(${currentRotation}deg)`;

            // ç­‰å¾…å‹•ç•«çµæŸ (7000æ¯«ç§’ = 7ç§’)
            setTimeout(() => {
                document.getElementById('modalWinner').innerText = activeNames[lastWinnerIndex];
                document.getElementById('modalPrize').innerText = `ç²å¾—äº†ï¼š${luckyPrize}`;
                modal.style.display = "flex";
                
                // å¯«å…¥ç´€éŒ„
                const log = document.createElement('div');
                log.style.marginBottom = "5px";
                log.innerHTML = `<small style="color:#999">[${new Date().toLocaleTimeString()}]</small> <strong>${activeNames[lastWinnerIndex]}</strong> - ${luckyPrize}`;
                document.getElementById('historyList').prepend(log);

                isSpinning = false;
                spinBtn.disabled = false;
                statusText.innerText = "æ­å–œï¼è«‹é—œé–‰å½ˆçª—æŸ¥çœ‹æ›´æ–°åå–®ã€‚";
            }, 7000); 
        }

        // é—œé–‰å½ˆçª—ä¸¦æ±ºå®šæ˜¯å¦å‰”é™¤
        function closeModal() {
            modal.style.display = "none";
            
            if (autoRemoveCheckbox.checked && lastWinnerIndex !== -1) {
                activeNames.splice(lastWinnerIndex, 1);
                namesInput.value = activeNames.join('\n');
                updateWheel(); 
                lastWinnerIndex = -1;
                statusText.innerText = "åå–®å·²æ›´æ–°ï¼Œæº–å‚™ä¸‹ä¸€è¼ªæŠ½çï¼";
            }
        }

        // é é¢åŠ è¼‰æ™‚åˆå§‹åŒ–
        updateWheel();
    </script>
</body>
</html>