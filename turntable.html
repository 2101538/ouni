<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å‹•æ…‹æŠ½å¾Œå‰”é™¤è½‰ç›¤</title>
    <style>
        body { font-family: 'PingFang TC', sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .main-layout { display: flex; gap: 30px; max-width: 1100px; width: 100%; }
        .config-panel { flex: 1; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .wheel-panel { flex: 2; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; position: relative; }
        
        textarea { width: 100%; height: 120px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; padding: 10px; box-sizing: border-box; resize: none; }
        button { background: #ff4757; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-size: 18px; width: 100%; font-weight: bold; transition: 0.3s; }
        button:hover { background: #ff6b81; transform: translateY(-2px); }
        button:disabled { background: #ccc; cursor: not-allowed; }

        /* è½‰ç›¤å®¹å™¨ */
        .wheel-container { position: relative; margin: 20px auto; width: 400px; height: 400px; }
        #wheelCanvas { width: 100%; height: 100%; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); }
        .pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #333; z-index: 10; }

        .history { margin-top: 20px; text-align: left; height: 150px; overflow-y: auto; background: #fafafa; padding: 10px; border-radius: 6px; font-size: 14px; }
        .count-badge { background: #2f3542; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; }
    </style>
</head>
<body>

    <h1>ğŸ¯ è‡ªå‹•å‰”é™¤æŠ½çç³»çµ±</h1>

    <div class="main-layout">
        <div class="config-panel">
            <h3>ğŸ‘¥ å‰©é¤˜äººå“¡ <span id="userCount" class="count-badge">0</span></h3>
            <textarea id="namesInput" placeholder="è¼¸å…¥åå–®ï¼Œæ¯è¡Œä¸€äºº">å¼µä¸‰&#10;æå››&#10;ç‹äº”&#10;è¶™å…­&#10;éŒ¢ä¸ƒ&#10;å­«å…«</textarea>
            
            <h3>ğŸ çé …æ± </h3>
            <textarea id="prizesInput" placeholder="è¼¸å…¥çé …">å¤§å‰ï¼šPS5&#10;ä¸­å‰ï¼šSwitch&#10;å°å‰ï¼šå’–å•¡åˆ¸</textarea>
            
            <button id="spinBtn" onclick="spin()">ğŸ‰ é–‹å§‹æŠ½ç</button>
            
            <div class="history">
                <strong>ğŸ“œ ç²çç´€éŒ„ï¼š</strong>
                <div id="historyList"></div>
            </div>
        </div>

        <div class="wheel-panel">
            <div class="wheel-container">
                <div class="pointer"></div>
                <canvas id="wheelCanvas" width="800" height="800"></canvas>
            </div>
            <h2 id="status">æº–å‚™å°±ç·’ï¼</h2>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const namesTextarea = document.getElementById('namesInput');
        const prizesTextarea = document.getElementById('prizesInput');
        const statusText = document.getElementById('status');
        const spinBtn = document.getElementById('spinBtn');

        let names = [];
        let currentRotation = 0;
        let isSpinning = false;

        // åˆå§‹åŒ–èˆ‡ç›£è½è¼¸å…¥
        function updateWheel() {
            names = namesTextarea.value.trim().split('\n').filter(n => n !== "");
            document.getElementById('userCount').innerText = names.length;
            drawWheel();
        }

        namesTextarea.addEventListener('input', updateWheel);
        updateWheel();

        // ç¹ªè£½è½‰ç›¤
        function drawWheel() {
            const num = names.length;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = centerX - 10;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (num === 0) {
                ctx.textAlign = "center";
                ctx.font = "40px Arial";
                ctx.fillText("è«‹è¼¸å…¥åå–®", centerX, centerY);
                return;
            }

            const angleStep = (Math.PI * 2) / num;

            names.forEach((name, i) => {
                const startAngle = i * angleStep;
                const endAngle = (i + 1) * angleStep;

                // ç•«æ‰‡å€
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.fillStyle = `hsl(${(i * 360) / num}, 70%, 70%)`;
                ctx.fill();
                ctx.stroke();

                // ç•«æ–‡å­—
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + angleStep / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#333";
                ctx.font = "bold 30px Arial";
                ctx.fillText(name, radius - 30, 10);
                ctx.restore();
            });
        }

        // æŠ½çé‚è¼¯
        function spin() {
            if (isSpinning || names.length === 0) return;
            
            const prizes = prizesTextarea.value.trim().split('\n').filter(p => p !== "");
            if (prizes.length === 0) { alert("è«‹è¼¸å…¥çé …ï¼"); return; }

            isSpinning = true;
            spinBtn.disabled = true;
            statusText.innerText = "è½‰å‹•ä¸­...";

            // éš¨æ©Ÿæ±ºå®šä¸­çç´¢å¼•
            const selectedIdx = Math.floor(Math.random() * names.length);
            const luckyPrize = prizes[Math.floor(Math.random() * prizes.length)];
            
            // è¨ˆç®—æ—‹è½‰è§’åº¦ï¼šè®“æŒ‡æ¨™åœåœ¨é¸ä¸­çš„æ‰‡å€
            // æŒ‡æ¨™åœ¨æ­£ä¸Šæ–¹(270åº¦)ï¼Œè½‰ç›¤åº§æ¨™ç³»0åº¦åœ¨å³å´ï¼Œéœ€è¦è£œå„Ÿè¨ˆç®—
            const sectorDegree = 360 / names.length;
            const stopDegree = 360 - (selectedIdx * sectorDegree) - (sectorDegree / 2);
            
            const extraRounds = 360 * 8; // è½‰8åœˆ
            currentRotation += extraRounds + (stopDegree - (currentRotation % 360));
            
            canvas.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                const winner = names[selectedIdx];
                const resultMsg = `${winner} æŠ½ä¸­äº† [${luckyPrize}]`;
                statusText.innerText = `ğŸŠ ${resultMsg}`;

                // 1. ç´€éŒ„çµæœ
                const log = document.createElement('div');
                log.innerText = `[${new Date().toLocaleTimeString()}] ${resultMsg}`;
                document.getElementById('historyList').prepend(log);

                // 2. æŠ½å¾Œå‰”é™¤ï¼šå¾åå–®é™£åˆ—ä¸­åˆªé™¤
                names.splice(selectedIdx, 1);
                
                // 3. æ›´æ–°è¼¸å…¥æ¡†èˆ‡è½‰ç›¤
                namesTextarea.value = names.join('\n');
                updateWheel();

                isSpinning = false;
                spinBtn.disabled = false;
            }, 4000);
        }
    </script>
</body>
</html>