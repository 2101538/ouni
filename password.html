<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´…ç™½å¹´æœƒçµ‚æ¥µå¯†ç¢¼ - éœ‡æ’¼ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-red: #e60012;
            --pure-white: #ffffff;
            --soft-gray: #f4f4f4;
            --dark-red: #a50000;
        }
        
        /* è¢å¹•æ™ƒå‹•å‹•ç•« */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake-effect { animation: shake 0.5s; animation-iteration-count: infinite; }

        body { 
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; 
            background-color: var(--primary-red);
            color: var(--primary-red);
            margin: 0; padding: 20px;
            display: flex; justify-content: center; align-items: flex-start;
            min-height: 100vh; overflow-x: hidden;
        }
        .main-layout { display: flex; gap: 20px; max-width: 1200px; width: 100%; margin-top: 20px; }
        
        .game-container {
            background: var(--pure-white);
            flex: 2; padding: 30px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        /* ç©å®¶è¼ªå€¼è¡¨æ¨£å¼ */
        .player-queue {
            margin: 20px 0; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;
        }
        .player-tag {
            padding: 8px 15px; border: 2px solid #ddd; border-radius: 20px;
            background: #eee; color: #666; font-weight: bold; transition: 0.3s;
        }
        .player-tag.active-now {
            background: var(--primary-red); color: white; border-color: var(--primary-red);
            transform: scale(1.2); box-shadow: 0 0 10px rgba(230,0,18,0.4);
        }

        .history-panel {
            flex: 1; background: rgba(255, 255, 255, 0.9);
            padding: 20px; border-radius: 15px; min-height: 500px;
        }

        .setup-section, .game-section { display: none; }
        .active { display: block; }
        input, textarea { padding: 12px; font-size: 16px; border-radius: 5px; border: 2px solid var(--primary-red); margin: 10px 0; width: 90%; }
        button { padding: 12px 25px; font-size: 18px; font-weight: bold; cursor: pointer; background: var(--primary-red); color: white; border: none; border-radius: 5px; }
        .range-box { font-size: 80px; font-weight: 900; margin: 10px 0; }
        
        #heartbeat { font-size: 20px; color: var(--primary-red); font-weight: bold; display: none; animation: beat 0.8s infinite; }
        @keyframes beat { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .record-item { border-bottom: 1px dashed var(--primary-red); padding: 10px 0; font-size: 14px; color: #333; }
    </style>
</head>
<body id="bodyTag">

<div class="main-layout">
	<h1>çµ‚æ–¼å¯†ç¢¼</h1>
    <div class="game-container">
        <div id="setup" class="setup-section active">
            <h3>éŠæˆ²åˆå§‹åŒ–</h3>
            <input type="text" id="playerNames" placeholder="ç©å®¶å§“å (ä¾‹: é·—å€ª, é·—å€ª2è™Ÿ, é·—å€ª3è™Ÿ)">
            <p>è¼¸å…¥çæ‡² (æ¯è¡Œä¸€å€‹ = ç¸½å±€æ•¸)ï¼š</p>
            <textarea id="prizes" rows="5" placeholder="ä¾‹ï¼š&#10;æŠ½ç´…åŒ…&#10;è¡¨æ¼”æ‰è—" oninput="updateRoundCount()"></textarea>
            <p>ç•¶å‰åµæ¸¬å±€æ•¸ï¼š<b id="roundHint">0</b> å±€</p>
            <button onclick="initGame()">é€²å…¥å°æˆ°</button>
        </div>

        <div id="game" class="game-section">
            <h2 id="roundTitle">ç¬¬ 1 å±€</h2>
            
            <div class="player-queue" id="queueDisplay"></div>

            <div id="heartbeat">ğŸ’“ æ¥è¿‘ç‚¸å½ˆä¸­... ğŸ’“</div>
            
            <div id="passwordSetup">
                <p>è«‹ä¸»æŒäººè¼¸å…¥æœ¬å±€ç‚¸å½ˆ (1-100)ï¼š</p>
                <input type="password" id="secret" style="text-align:center; font-size: 24px;">
                <br><button onclick="confirmSecret()">é–å®šå¯†ç¢¼</button>
            </div>
            
            <div id="playArea" style="display:none;">
                <div class="range-box"><span id="min">1</span> ~ <span id="max">100</span></div>
                <input type="number" id="guess" placeholder="è«‹è¼¸å…¥æ•¸å­—">
                <br><button onclick="submitGuess()">é€å‡º</button>
            </div>
        </div>
    </div>

    <div class="history-panel">
        <h3>ğŸ“‹ ç²çç´€éŒ„</h3>
        <div id="historyList"><p style="color:#999;">æš«ç„¡ç´€éŒ„...</p></div>
    </div>
</div>

<script>
    let players = [];
    let prizePool = [];
    let totalRounds = 0;
    let currentRound = 1;
    let currentPlayerIndex = 0;
    let secretNum, minBound, maxBound;

    function updateRoundCount() {
        const list = document.getElementById('prizes').value.split('\n').filter(p => p.trim() !== "");
        document.getElementById('roundHint').innerText = list.length;
    }

    function initGame() {
        const nameInput = document.getElementById('playerNames').value;
        players = nameInput.split(',').map(n => n.trim()).filter(n => n !== "");
        prizePool = document.getElementById('prizes').value.split('\n').filter(p => p.trim() !== "");
        totalRounds = prizePool.length;

        if (players.length < 2) return alert("è«‹è‡³å°‘è¼¸å…¥å…©ä½ç©å®¶ï¼");
        if (totalRounds < 1) return alert("è«‹è¨­å®šçé …ï¼");

        document.getElementById('setup').classList.remove('active');
        document.getElementById('game').classList.add('active');
        startNewRound();
    }

    function startNewRound() {
        document.getElementById('roundTitle').innerText = `ç¬¬ ${currentRound} / ${totalRounds} å±€`;
        document.getElementById('passwordSetup').style.display = 'block';
        document.getElementById('playArea').style.display = 'none';
        document.getElementById('heartbeat').style.display = 'none';
        document.getElementById('secret').value = '';
        minBound = 1;
        maxBound = 100;
        renderQueue();
        updateDisplay();
    }

    function renderQueue() {
        const container = document.getElementById('queueDisplay');
        container.innerHTML = '';
        players.forEach((p, index) => {
            const span = document.createElement('span');
            span.className = `player-tag ${index === currentPlayerIndex ? 'active-now' : ''}`;
            span.innerText = `${index + 1}. ${p}`;
            container.appendChild(span);
        });
    }

    function confirmSecret() {
        secretNum = parseInt(document.getElementById('secret').value);
        if (isNaN(secretNum) || secretNum <= 1 || secretNum >= 100) return alert("è«‹è¼¸å…¥ 2-99 ä¹‹é–“çš„æ•¸å­—ï¼");
        document.getElementById('passwordSetup').style.display = 'none';
        document.getElementById('playArea').style.display = 'block';
    }

    function updateDisplay() {
        document.getElementById('min').innerText = minBound;
        document.getElementById('max').innerText = maxBound;
        document.getElementById('heartbeat').style.display = (maxBound - minBound < 15) ? 'block' : 'none';
        renderQueue();
    }

    function triggerShake() {
        const body = document.getElementById('bodyTag');
        body.classList.add('shake-effect');
        setTimeout(() => body.classList.remove('shake-effect'), 1000); // éœ‡å‹•1ç§’
    }

    function submitGuess() {
        const guessField = document.getElementById('guess');
        const guess = parseInt(guessField.value);

        if (isNaN(guess) || guess <= minBound || guess >= maxBound) {
            alert(`è«‹è¼¸å…¥ ${minBound+1} ~ ${maxBound-1}`);
            return;
        }

        if (guess === secretNum) {
            triggerShake(); // éœ‡å‹•
            confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } }); // å½©å¸¶
            
            const prizeIndex = Math.floor(Math.random() * prizePool.length);
            const prize = prizePool.splice(prizeIndex, 1)[0];
            
            addRecord(currentRound, players[currentPlayerIndex], prize);
            
            setTimeout(() => {
                alert(`ğŸ’¥ ç °ï¼ï¼ã€${players[currentPlayerIndex]}ã€‘çˆ†ç‚¸äº†ï¼\nçµæœï¼š${prize}`);
                if (currentRound < totalRounds) {
                    currentRound++;
                    startNewRound();
                } else {
                    document.getElementById('playArea').innerHTML = "<h2>ğŸ‰ å…¨éƒ¨çµæŸ ğŸ‰</h2>";
                }
            }, 600);
        } else {
            if (guess < secretNum) minBound = guess;
            else maxBound = guess;
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            updateDisplay();
        }
        guessField.value = '';
    }

    function addRecord(round, winner, prize) {
        const historyList = document.getElementById('historyList');
        if (currentRound === 1) historyList.innerHTML = '';
        const div = document.createElement('div');
        div.className = 'record-item';
        div.innerHTML = `å±€æ•¸ ${round}: <b>${winner}</b><br>â”” ${prize}`;
        historyList.prepend(div);
    }
</script>
</body>
</html>